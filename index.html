<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini WMS — FIFO / FEFO (Full UI)</title>
<style>
  :root{--bg:#f6f7fb;--card:#fff;--muted:#6b7280;--accent:#0b5fff}
  body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#0f172a}
  .wrap{max-width:1100px;margin:28px auto;padding:20px}
  header{display:flex;align-items:center;justify-content:space-between;gap:16px}
  h1{margin:0;font-size:20px}
  .grid{display:grid;gap:14px}
  .cols-3{grid-template-columns:1fr 1fr 1fr}
  .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 1px 3px rgba(2,6,23,0.06)}
  label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
  input, select, textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #e6e9ef;font-size:14px;box-sizing:border-box}
  button{background:var(--accent);color:white;border:0;padding:8px 10px;border-radius:7px;cursor:pointer}
  button.ghost{background:transparent;color:var(--accent);border:1px solid #dbe4ff}
  table{width:100%;border-collapse:collapse;font-size:13px}
  th,td{padding:8px;border-bottom:1px solid #f1f3f7;text-align:left}
  th{color:var(--muted);font-weight:600;font-size:12px}
  .muted{color:var(--muted);font-size:13px}
  .badge{display:inline-block;padding:3px 8px;border-radius:999px;background:#eef2ff;color:var(--accent);font-size:12px}
  .danger{background:#ffeef0;color:#b91c1c}
  .small{font-size:12px}
  pre{white-space:pre-wrap;background:#0b1220;color:#dbeafe;padding:10px;border-radius:6px;overflow:auto}
  .row{display:flex;gap:8px;align-items:center}
  .split{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .right{justify-self:end}
  .note{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Mini WMS — Full UI (FIFO / FEFO)</h1>
      <div class="muted small">Inbound / Outbound, lots, expiry, FEFO/FIFO picking. Data stored on server.</div>
    </div>
    <div class="row">
      <button id="btnReset" class="ghost">Reset Demo Data</button>
      <button id="btnExport" title="Export inventory CSV">Export Inventory CSV</button>
    </div>
  </header>

  <main class="grid" style="margin-top:16px">
    <section class="card">
      <h3 style="margin:0 0 10px 0">Inbound (Receive)</h3>
      <div class="split">
        <div>
          <label>SKU</label><input id="in_sku" placeholder="SKU-2001"/>
          <label>Name</label><input id="in_name" placeholder="USB Charger 20W"/>
          <label>Qty</label><input id="in_qty" type="number" value="10"/>
        </div>
        <div>
          <label>Batch (optional)</label><input id="in_batch" placeholder="BATCH-001"/>
          <label>Expiry (optional)</label><input id="in_exp" type="date"/>
          <label>Location (optional)</label><input id="in_loc" placeholder="A1-01"/>
        </div>
      </div>
      <div class="row" style="margin-top:8px">
        <button onclick="inbound()">Receive</button>
        <button onclick="seed()" class="ghost">Seed Demo</button>
      </div>
    </section>

    <section class="card">
      <h3 style="margin:0 0 10px 0">Outbound (Pick)</h3>
      <label>SKU</label><input id="out_sku" placeholder="SKU-2001"/>
      <label>Qty</label><input id="out_qty" type="number" value="5"/>
      <label>Mode</label><select id="out_mode"><option value="FEFO">FEFO</option><option value="FIFO">FIFO</option></select>
      <label>Min days to expiry (optional)</label><input id="out_minDays" type="number" placeholder="e.g. 7"/>
      <div class="row" style="margin-top:8px"><button onclick="outbound()">Pick</button></div>
      <div class="muted" id="out_result" style="margin-top:8px"></div>
    </section>

    <section class="card">
      <h3 style="margin:0 0 10px 0">Lots (Inventory)</h3>
      <div class="muted">Shows per-lot quantities and expiry.</div>
      <table id="tblLots"><thead><tr><th>SKU</th><th>Name</th><th>Qty</th><th>Batch</th><th>Location</th><th>Received</th><th>Expiry</th><th>Status</th><th>Action</th></tr></thead><tbody></tbody></table>
    </section>

    <section class="card">
      <h3 style="margin:0 0 10px 0">Summary</h3>
      <table id="tblSum"><thead><tr><th>SKU</th><th>Name</th><th>Total Qty</th><th>Lots</th><th>Soonest Expiry</th></tr></thead><tbody></tbody></table>
    </section>

    <section class="card">
      <h3 style="margin:0 0 10px 0">Movement History</h3>
      <table id="tblHist"><thead><tr><th>Type</th><th>SKU</th><th>Qty</th><th>Details</th><th>Timestamp</th></tr></thead><tbody></tbody></table>
    </section>

  </main>
</div>

<script>
async function jget(u){ const r=await fetch(u); if(!r.ok) throw new Error('HTTP '+r.status); return r.json(); }
async function jpost(u,b){ const r=await fetch(u,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(b)}); const t=await r.text(); try{ return JSON.parse(t);}catch{ if(!r.ok) throw new Error(t); return t; } }

async function refresh(){
  const lots = await jget('/api/stock');
  const tb = document.querySelector('#tblLots tbody'); tb.innerHTML='';
  lots.forEach(l=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${l.sku}</td><td>${l.name}</td><td>${l.qty}</td><td>${l.batch||'-'}</td><td>${l.location||'-'}</td><td>${l.received_at.slice(0,10)}</td><td>${l.expiry||'-'}</td><td>${l.status}</td><td><button onclick="delLot('${l.id}')" style="background:#ef4444">Delete</button></td>`;
    tb.appendChild(tr);
  });
  const sum = await jget('/api/summary');
  const sb = document.querySelector('#tblSum tbody'); sb.innerHTML='';
  sum.forEach(s=>{ const tr=document.createElement('tr'); tr.innerHTML = `<td>${s.sku}</td><td>${s.name}</td><td>${s.qty}</td><td>${s.lots}</td><td>${s.soonest_expiry||'-'}</td>`; sb.appendChild(tr); });
  const hist = await jget('/api/history');
  const hb = document.querySelector('#tblHist tbody'); hb.innerHTML='';
  hist.slice().reverse().forEach(h=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${h.type}</td><td>${h.sku}</td><td>${h.qty}</td><td><code>${JSON.stringify(h.details||{})}</code></td><td>${new Date(h.ts).toLocaleString()}</td>`; hb.appendChild(tr); });
}

async function inbound(){ const sku=document.getElementById('in_sku').value.trim(); const name=document.getElementById('in_name').value.trim(); const qty=Number(document.getElementById('in_qty').value||0); const batch=document.getElementById('in_batch').value.trim()||null; const expiry=document.getElementById('in_exp').value||null; const loc=document.getElementById('in_loc').value.trim()||'DEFAULT'; if(!sku||!name||!qty){alert('Fill SKU/name/qty');return;} await jpost('/api/inbound',{sku,name,qty,batch,expiry,location:loc}); document.getElementById('in_qty').value=''; refresh(); }

async function outbound(){ const sku=document.getElementById('out_sku').value.trim(); const qty=Number(document.getElementById('out_qty').value||0); const mode=document.getElementById('out_mode').value; const minDays=document.getElementById('out_minDays').value ? Number(document.getElementById('out_minDays').value) : undefined; if(!sku||!qty){alert('Fill SKU and qty');return;} const res=await jpost('/api/outbound',{sku,qty,mode,minDaysToExpiry:minDays}); document.getElementById('out_result').textContent = 'Picked '+res.qty+' lots: '+res.picks.map(p=>`${p.batch||p.lotId}×${p.qty}`).join(', '); refresh(); }

async function delLot(id){ if(!confirm('Delete lot?')) return; const r=await fetch('/api/stock/'+id,{method:'DELETE'}); if(!r.ok){ alert('Failed'); return } refresh(); }

async function seed(){ await jpost('/api/reset',{}); refresh(); }

document.getElementById('btnReset').addEventListener('click', seed);
document.getElementById('btnExport').addEventListener('click', async ()=>{ const lots=await jget('/api/stock'); const rows = lots.map(r=>[r.sku,r.batch||'',r.location,r.qty,r.received_at.slice(0,10),r.expiry||''].join(',')); const csv=['sku,batch,location,qty,received_at,expiry',...rows].join('\n'); const blob=new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='inventory.csv'; a.click(); URL.revokeObjectURL(a.href); });

refresh();
</script>
</body>
</html>
